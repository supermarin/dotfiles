### UI
default_border pixel 4
gaps inner 7
smart_borders on
smart_gaps on
seat seat0 xcursor_theme Adwaita 24

# # Set colors
set $c_black #111111
set $c_darkgrey #222222
set $c_lightgrey #DEDEDE
# accent colors from macos
# https://developer.apple.com/design/human-interface-guidelines/foundations/color
set $c_grey #64727D
set $c_blue #0084ff
set $c_miami_green #003020
set $c_dwr_green #182d2a
set $c_green $c_dwr_green
set $c_orange #ff9f0a
set $c_miami_pink #f1c5d2
set $c_pink #ff375f
set $c_teal #40c8e0
set $c_accent $c_miami_pink

# class                 border     background  text         indicator  child_border
client.focused          $c_black   $c_accent   $c_darkgrey  $c_accent  $c_accent
client.focused_inactive $c_black   $c_darkgrey $c_lightgrey $c_black   $c_black
client.unfocused        $c_black   $c_black    $c_grey      $c_black   $c_black

# Status Bar:
#
bar {
    position top
    font pango: Inter Medium 11
    status_command i3status-rs
    colors {
        separator          #111111AA 
        background         #111111AA
        statusline         #ffffff
        focused_workspace  $c_darkgrey  $c_black    #ffffff
        active_workspace   #900000      #333333     #ffffff
        inactive_workspace $c_darkgrey  $c_darkgrey $c_lightgrey
        urgent_workspace   #900000      #900000     #ffffff
    }
    tray_output none
}

###############################################################################

### Variables
#
# Mod4 - Logo key. Mod1 - Alt.
set $mod Mod4
set $mod2 Mod1

set $left h
set $down j
set $up k
set $right l
set $term rio 
set $browser firefox
set $menu rofi -show combi
set $notification-center swaync-client -t -sw

### Output configuration
output * bg $c_green solid_color

set $laptop eDP-1
output $laptop {
  scale 1.25
}

# # DP-3
# output 'Apple Computer Inc ProDisplayXDR 0x00001F08' {
#   pos 0 0
#   mode 6016x3384@60.000Hz
#   scale 2
# }
#
# TODO: figure out how to distinguish DP-3 from DP-4 since they both seem to
#       have the same hex identifier
# output 'Apple Computer Inc ProDisplayXDR 0x00001F08' {
#   disable
# }


output 'Apple Computer Inc StudioDisplay 0x0000FF20' {
  pos 0 0
}

output 'LG Electronics LG UltraFine 806NTJJ3B908' {
  scale 2
  mode 2560x2880@60.000Hz
}

# 21" Ultrafine
output 'LG Electronics LG UltraFine 612NTAB2R080' {
  mode 4096x2304@60.000Hz
  scale 2
  pos 0 0
}

# 21" Ultrafine
output 'LG Electronics LG UltraFine 806NTVS9V703' {
  mode 4096x2304@60.000Hz
  scale 2 
  pos 0 1152
}

# Turn off laptop monitor when lid is down
bindswitch --reload --locked lid:on output $laptop disable
bindswitch --reload --locked lid:off output $laptop enable

### Input configuration
#
input * {
    repeat_delay 175
    repeat_rate  75
    natural_scroll enabled
}

input 6127:24801:TrackPoint_Keyboard_II {
    xkb_options ctrl:nocaps,altwin:swap_lalt_lwin
}

input 1:1:AT_Translated_Set_2_keyboard {
    xkb_options ctrl:nocaps,altwin:swap_lalt_lwin
}
input 16700:34053:Dell_Dell_Universal_Receiver {
    xkb_options ctrl:nocaps,altwin:swap_lalt_lwin
}

### Idle configuration
#
exec swayidle -w \
       timeout 300 'swaylock -f -c 000000' \
       timeout 600 'swaymsg "output * power off"' resume 'swaymsg "output * power on"' \
         before-sleep 'swaylock -f -c 000000'

# Screen lock
bindsym $mod+Shift+q exec swaylock -f -c 000000


# Drag floating windows by holding down $mod and left mouse button.
# Resize them with right mouse button + $mod.
# Despite the name, also works for non-floating windows.
# Change normal to inverse to use left mouse button for resizing and right
# mouse button for dragging.
floating_modifier $mod normal

# Assign apps to consistent workspaces
for_window [title="floating_term"] floating enable

# Make all GNOME (and some other) apps float
for_window [app_id="(org.gnome.*|gnome-*|telegramdesktop|cawbird|wdisplays|galculator|pavucontrol|ulauncher)"] {
  floating enable
  border none
}

### Key bindings
#
# Start a terminal
bindsym $mod+Return exec $term
bindsym $mod+t workspace 3; exec pgrep $term || $term
# Zulip
bindsym $mod+z workspace 5; exec pgrep zulip || zulip --enable-features=UseOzonePlatform --ozone-platform=wayland
# NetworkManager connect
bindsym $mod+w exec $term --title floating_term nmtui-connect
# Emoji
bindsym $mod+Ctrl+Space exec rofimoji
# File manager
bindsym $mod+e exec nautilus --new-window
# Start a browser
bindsym $mod+b workspace 2; exec pgrep $browser || $browser
# Switch to Obsidian
bindsym $mod+o workspace 1; exec ps ax | grep -v grep | grep obsidian || obsidian --enable-features=UseOzonePlatform --ozone-platform=wayland
# Kill focused window
bindsym $mod+q kill
# Start launcher
bindsym $mod+Space exec $menu
# Reload the configuration file
bindsym $mod+Shift+c reload
# Toggle notification control center
bindsym $mod+Shift+n exec $notification-center
# Exit sway (logs you out of your Wayland session)
bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -b 'Yes, exit sway' 'swaymsg exit'
# [HACK] Power monitor on/off. Obesrved this on DisplayPort only - sometimes 
bindsym $mod+Shift+d exec swaymsg output DP-1 power off && swaymsg output DP-1 power on
# Moving around:
#
# Move your focus around
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

# Move the focused window with the same, but add Shift
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$left move left

# Move workspace between monitors
bindsym $mod+$mod2+$up move workspace to output up
bindsym $mod+$mod2+$right move workspace to output right
bindsym $mod+$mod2+$down move workspace to output down
bindsym $mod+$mod2+$left move workspace to output left

# Workspaces:
#
# Switch to workspace
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 scratchpad show

# Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9

# Layout stuff:
#
# You can "split" the current object of your focus with
bindsym $mod+backslash splith
bindsym $mod+minus splitv

# Switch the current container between different layout styles
bindsym $mod+Shift+s layout stacking
bindsym $mod+Shift+w layout tabbed

# Make the current focus fullscreen
bindsym $mod+f fullscreen

# Toggle the current focus between tiling and floating mode
bindsym $mod+Shift+space floating toggle

# Send the current window to scratchpad
bindsym $mod+Shift+0 move container to scratchpad

# Swap focus between the tiling area and the floating area
bindsym $mod+$mod2+space focus mode_toggle

# Move focus to the parent container
bindsym $mod+a focus parent

# Resizing containers:
#
mode "resize" {
    bindsym $left resize shrink width 20px
    bindsym $down resize grow height 20px
    bindsym $up resize shrink height 20px
    bindsym $right resize grow width 20px
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

bindsym $mod+r mode "resize"

# Media controls (sorted by lenovo kb):
bindsym XF86AudioRaiseVolume exec amixer set Master 5%+ | sed -En 's/.*\[([0-9]+)%\].*/\1/p' | head -1 > $WOBSOCK
bindsym XF86AudioLowerVolume exec amixer set Master 5%- | sed -En 's/.*\[([0-9]+)%\].*/\1/p' | head -1 > $WOBSOCK
bindsym $mod2+XF86AudioRaiseVolume exec amixer set Master 1%+ | sed -En 's/.*\[([0-9]+)%\].*/\1/p' | head -1 > $WOBSOCK
bindsym $mod2+XF86AudioLowerVolume exec amixer set Master 1%- | sed -En 's/.*\[([0-9]+)%\].*/\1/p' | head -1 > $WOBSOCK
bindsym XF86AudioMute exec amixer set Master toggle | sed -En '/\[on\]/ s/.*\[([0-9]+)%\].*/\1/ p; /\[off\]/ s/.*/0/p' | head -1 > $WOBSOCK
bindsym XF86AudioMicMute exec amixer set Capture toggle
# keyboard gap
bindsym XF86MonBrightnessDown exec brightnessctl set 5%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym XF86MonBrightnessUp exec brightnessctl set +5% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym $mod2+XF86MonBrightnessDown exec brightnessctl set 1%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym $mod2+XF86MonBrightnessUp exec brightnessctl set +1% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK

bindsym Shift+XF86MonBrightnessDown exec lgufbrightness - | tail -n1 | cut -f4 -d ' '  > $WOBSOCK
bindsym Shift+XF86MonBrightnessUp exec lgufbrightness + | tail -n1 | cut -f4 -d ' '  > $WOBSOCK
bindsym Shift+$mod2+XF86MonBrightnessDown exec lgufbrightness _ | tail -n1 | cut -f4 -d ' '  > $WOBSOCK
bindsym Shift+$mod2+XF86MonBrightnessUp exec lgufbrightness = | tail -n1 | cut -f4 -d ' '  > $WOBSOCK
#  XF86WLAN

bindsym XF86NotificationCenter exec $notification-center
# XF86PickupPhone
# XF86HangupPhone
# XF86Favorites

# XF86SelectiveScreenshot # fn + printscreen
# XF86SelectiveScreenshot # fn + space

bindsym XF86AudioPlay exec playerctl play-pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

# Take a screenshot with all output and save it into screenshots
bindsym $mod+$mod2+3 exec grim -t jpeg ~/Pictures/Screenshots/$(date +%Y-%m-%d_%H-%m-%s).jpg
bindsym $mod+$mod2+4 exec grim -t jpeg -g "$(slurp)" ~/Pictures/Screenshots/$(date +%Y-%m-%d_%H-%m-%s).jpg


# Unfuck launching GNOME apps (takes 20 seconds otherwise)
exec systemctl --user import-environment
exec systemctl --user start sway-session.target
# TODO: not sure if this is needed anymore, getting off GNOME
exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=sway

# Startup commands
exec swaync

set $WOBSOCK $XDG_RUNTIME_DIR/wob.sock
# TODO: figure out why these two can't go in the same line, and fix the initial bar showing on sway load
exec rm -f $WOBSOCK && mkfifo $WOBSOCK && tail -f $WOBSOCK | wob
exec udiskie
exec autotiling-rs
